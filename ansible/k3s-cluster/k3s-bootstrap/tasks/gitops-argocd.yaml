- name: checkout gitops-public repo
  ansible.builtin.git:
    repo: '{{ gitops.public_repo }}'
    dest: /tmp/gitops-public
    update: yes

- name: deploy argocd
  kubernetes.core.helm:
    name: argocd
    chart_ref: argo/argo-cd
    release_namespace: argocd
    create_namespace: true
    values_files:
      - "/tmp/gitops-public/{{ gitops.argocd_values }}"
    update_repo_cache: true
  environment:
    KUBECONFIG: /etc/rancher/k3s/k3s.yaml